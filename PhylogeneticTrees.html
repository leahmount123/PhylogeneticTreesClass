<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>MT24W5: Phylogenetic Trees</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="PhylogeneticTrees_files/libs/clipboard/clipboard.min.js"></script>
<script src="PhylogeneticTrees_files/libs/quarto-html/quarto.js"></script>
<script src="PhylogeneticTrees_files/libs/quarto-html/popper.min.js"></script>
<script src="PhylogeneticTrees_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="PhylogeneticTrees_files/libs/quarto-html/anchor.min.js"></script>
<link href="PhylogeneticTrees_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="PhylogeneticTrees_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="PhylogeneticTrees_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="PhylogeneticTrees_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="PhylogeneticTrees_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">MT24W5: Phylogenetic Trees</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="an-introduction" class="level2">
<h2 class="anchored" data-anchor-id="an-introduction">1. An introduction</h2>
<ul>
<li>Phylogenetic trees are central in biology for representing hierarchical relationships in the diversity of life</li>
<li>It is a useful and general skill to be able to manipulate, analyse and plot these trees</li>
<li>This practical also shows how to work with R packages that process a different kind of biological data</li>
<li>We will spend a bit of time peeking behind the curtain of the package
<ul>
<li>This will help us to understand the structure and logic of tree objects, and how R works with them</li>
</ul></li>
<li>There are many R packages for working with trees</li>
<li>Different research groups write their own functions and some of these get incorporated into existing packages
<ul>
<li>Others are used to make new packages</li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
APE: Analysis of Phylogenetics and Evolution
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is one of the earliest and widely known packages, and is what we will use in this project</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
How do I know which package to use for a given task, out of the wide range available?
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>The computer assignments help to build a portfolio of tasks to run, gaining confidence in finding/working with new packages</li>
<li>It is useful to use generative AI engines</li>
</ul>
</div>
</div>
</section>
<section id="the-ape-package-and-phylo-objects" class="level2">
<h2 class="anchored" data-anchor-id="the-ape-package-and-phylo-objects">2. The APE package and phylo objects</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ape)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(ape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The following code creates a completely unresolved tree with 10 tips:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>star.tree <span class="ot">&lt;-</span> <span class="fu">stree</span>(<span class="at">n=</span><span class="dv">10</span>, <span class="at">type=</span><span class="st">"star"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(stree)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(star.tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="PhylogeneticTrees_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>This gives a <em>star</em> phylogeny</li>
<li>The function has given arbitrary labels: t1, t2, etc.</li>
</ul>
<p>We can make array of named, numbered tip labels:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>my.tip.labels <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Species"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, <span class="at">sep=</span><span class="st">"."</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>my.tip.labels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Species.1" "Species.2" "Species.3" "Species.4" "Species.5" "Species.6"
[7] "Species.7" "Species.8"</code></pre>
</div>
</div>
<ul>
<li><strong>1:8</strong> creates the array c(1,2,3,4,5,6,7,8) then <strong>paste</strong> adds ‘Species’ to each number</li>
<li>They are separated using <strong>sep=“.”</strong></li>
</ul>
<p>The following code makes the <strong>imbalanced tree</strong> object:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>imbalanced.tree <span class="ot">&lt;-</span> <span class="fu">stree</span>(<span class="at">n=</span><span class="dv">8</span>, <span class="at">type=</span><span class="st">"right"</span>, <span class="at">tip.label=</span>my.tip.labels)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(imbalanced.tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="PhylogeneticTrees_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The following code makes the tree balanced:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>balanced.tree <span class="ot">&lt;-</span> <span class="fu">stree</span>(<span class="at">n=</span><span class="dv">8</span>, <span class="at">type=</span><span class="st">"balanced"</span>, <span class="at">tip.label=</span>my.tip.labels)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(balanced.tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="PhylogeneticTrees_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The following code asks how R actually encodes the information seen graphically in the plotted tree:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>balanced.tree</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Phylogenetic tree with 8 tips and 7 internal nodes.

Tip labels:
  Species.1, Species.2, Species.3, Species.4, Species.5, Species.6, ...

Rooted; no branch lengths.</code></pre>
</div>
</div>
<ul>
<li><p>It gives a summary of the properties of the tree</p></li>
<li><p>It does not show what the object is made up of</p></li>
<li><p>The <strong>phylo object</strong> is how the tree is represented in APE</p>
<ul>
<li>It is a list made up of several parts</li>
<li>These parts can be revealed using str()</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(balanced.tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 3
 $ edge     : int [1:14, 1:2] 9 10 11 11 10 12 12 9 13 14 ...
 $ tip.label: chr [1:8] "Species.1" "Species.2" "Species.3" "Species.4" ...
 $ Nnode    : int 7
 - attr(*, "class")= chr "phylo"
 - attr(*, "order")= chr "cladewise"</code></pre>
</div>
</div></li>
<li><p><strong>$edge</strong> is a table that specifies topology</p>
<ul>
<li>It is essentially a branch of a tree that connects 2 nodes</li>
</ul></li>
</ul>
<p>The following code accesses just the edge table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>balanced.tree<span class="sc">$</span>edge</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1] [,2]
 [1,]    9   10
 [2,]   10   11
 [3,]   11    1
 [4,]   11    2
 [5,]   10   12
 [6,]   12    3
 [7,]   12    4
 [8,]    9   13
 [9,]   13   14
[10,]   14    5
[11,]   14    6
[12,]   13   15
[13,]   15    7
[14,]   15    8</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Understanding the edge table
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>This table shows numbers that specify the branches</li>
<li>The numbers are assigned to each tip and internal of the tree
<ul>
<li>Tips: labelled 1-8</li>
<li>Internal nodes: 9-15</li>
</ul></li>
<li>There is always <em>N-2</em> internal nodes in a fully bifurcating tree
<ul>
<li>There are <em>2N-2</em> branches</li>
<li><em>N</em> = number of tips</li>
</ul></li>
<li><strong>Column 1</strong>: gives the ancestor</li>
<li><strong>Column 2</strong>: gives the descendant</li>
<li><strong>Row</strong>: a branch on the tree</li>
<li>E.g. tips 1 and 2 share a common ancestor
<ul>
<li>When looking at them as descendants, the ancestor of both is 11</li>
</ul></li>
</ul>
</div>
</div>
<p>We <em>could</em> label the internal nodes graphically, though not typically done:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(balanced.tree)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nodelabels</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="PhylogeneticTrees_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The notation for pulling entries out of a matrix/table is to use square brackets, <em>e.g.&nbsp;table[row,column]</em>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>balanced.tree<span class="sc">$</span>edge[i,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  9 10</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Understanding <strong>i &lt;- 1 | balanced.tree$edge[i,]</strong>
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>We have set branch i = 1
<ul>
<li>i is now an index representing the first row of the edge table</li>
</ul></li>
<li>In this function, we are accessing the first row</li>
<li>Result of code: the ancestral node and descendant node for the first edge of the tree</li>
</ul>
</div>
</div>
<p>The following code extracts the node the is the <strong>ancestor</strong> of branch i:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>balanced.tree<span class="sc">$</span>edge[i,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9</code></pre>
</div>
</div>
<p>The following code extracts the node that is the <strong>descendant</strong> of branch i:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>balanced.tree<span class="sc">$</span>edge[i,<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
</div>
<section id="we-can-also-work-the-other-way-around" class="level5">
<h5 class="anchored" data-anchor-id="we-can-also-work-the-other-way-around">We can also work the other way around:</h5>
<p>The following code finds which branch node/tip i:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(balanced.tree<span class="sc">$</span>edge[,<span class="dv">2</span>]<span class="sc">==</span>i)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<ul>
<li>As i=1, it is now referring to <strong>node 1</strong></li>
<li>Branch 3 is what leads to the first species</li>
</ul>
<p>The following code finds the ancestral node of node 1 (species 1):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>balanced.tree<span class="sc">$</span>edge[<span class="fu">which</span>(balanced.tree<span class="sc">$</span>edge[,<span class="dv">2</span>]<span class="sc">==</span><span class="dv">1</span>),<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11</code></pre>
</div>
</div>
<ul>
<li>11 is the ancestral node that leads to species 1</li>
</ul>
<p>The following code asks for the ancestral node of a specifically named tip:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>balanced.tree<span class="sc">$</span>edge[<span class="fu">which</span>(balanced.tree<span class="sc">$</span>edge[,<span class="dv">2</span>]<span class="sc">==</span><span class="fu">which</span>(balanced.tree<span class="sc">$</span>tip.label<span class="sc">==</span><span class="st">"Species.5"</span>)),<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Graphical note:
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>The display order of two branches descending from the same node <strong>does not convey any information</strong> as long as the topology and branch lengths remain the same</li>
<li>Rearranging this order can sometimes highlight patterns or make the tree look tidier
<ul>
<li>In APE, this is accomplished by rotating the internal nodes</li>
</ul></li>
<li>For instance, if we wanted to display the tips on the tree above in numerical order by species, we could do so by rotating each one of the internal nodes in turn</li>
</ul>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (each.node <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">9</span><span class="sc">:</span><span class="dv">15</span>)) {</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  balanced.tree <span class="ot">&lt;-</span> <span class="fu">rotate</span>(balanced.tree, <span class="at">node=</span>each.node)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(balanced.tree)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="fu">nodelabels</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="PhylogeneticTrees_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>For each node 9-5, they are rotated</li>
<li>E.g. if it was c(15), only 7 and 8 would flip
<ul>
<li><strong>Reason</strong>: they branch from node 15</li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>This example only worked neatly because we rotated each node in an order that just happened not to cause any tangling or conflicts</li>
<li>Applying <em>rotate</em> to multiple nodes at once is a tricky operation in APE
<ul>
<li>It is non-reversible, because each rotation changes the structure and order of the tree object that all subsequent rotations are applied to.</li>
</ul></li>
<li>While it is possible to rotate any or all internal nodes, doing so may require a stepwise approach, re-examining and re-labeling the tree each time</li>
<li>Non-intuitive behaviour during what ought to be a simple and topologically neutral operation illustrates one of the limitations of representing trees as an edge matrix, versus graphical software that displays trees more intuitively</li>
</ul>
</div>
</div>
</section>
</section>
<section id="random-trees" class="level2">
<h2 class="anchored" data-anchor-id="random-trees">3. Random trees</h2>
<ul>
<li>APE has several functions for making random trees
<ul>
<li>We will use <em>rcoal()</em></li>
</ul></li>
<li>This generates what is known as a <strong>coalescent tree</strong>
<ul>
<li>It picks tips at random to group together hierarchically until it reaches the common ancestor of all the tips</li>
</ul></li>
<li>It is particularly used to model genealogies of individuals within a species or population, yielding an <strong>ultrametric tree</strong>
<ul>
<li><strong>Ultrametric</strong>: all the tips are lined up and the branch lengths reflect relative time back to each hypothetical ancestor</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>random.coalescent <span class="ot">&lt;-</span> <span class="fu">rcoal</span>(<span class="at">n=</span><span class="dv">8</span>, <span class="at">tip.label=</span>my.tip.labels)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(random.coalescent)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">nodelabels</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="PhylogeneticTrees_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
This builds a <strong>different tree</strong> each time it is run
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>The code selects a random number to decide which tips group together</li>
<li>What changes?
<ol type="1">
<li>Topology; branching pattern, who groups with whom</li>
<li>Branch lengths</li>
</ol></li>
</ul>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>random.coalescent<span class="sc">$</span>edge</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1] [,2]
 [1,]    9   10
 [2,]   10   13
 [3,]   13    1
 [4,]   13    2
 [5,]   10   11
 [6,]   11    3
 [7,]   11    4
 [8,]    9   12
 [9,]   12    5
[10,]   12   14
[11,]   14    6
[12,]   14   15
[13,]   15    7
[14,]   15    8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>random.coalescent<span class="sc">$</span>tip.label</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Species.8" "Species.4" "Species.2" "Species.3" "Species.5" "Species.1"
[7] "Species.7" "Species.6"</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Can you work out the topology from the table and match it to the tree?
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is interpreted in the same way as before, but now we have seen the order of the species, which is random now, not numerical</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>random.coalescent<span class="sc">$</span>edge.length</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.04651531 1.06502522 0.17349559 0.17349559 0.25936879 0.97915202
 [7] 0.97915202 0.46631454 0.81872158 0.71000133 0.10872026 0.05921678
[13] 0.04950348 0.04950348</code></pre>
</div>
</div>
<ul>
<li>This stores an array of the branch lengths in the same order as the rows in the topology tables</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(random.coalescent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 4
 $ edge       : int [1:14, 1:2] 9 10 13 13 10 11 11 9 12 12 ...
 $ edge.length: num [1:14] 0.0465 1.065 0.1735 0.1735 0.2594 ...
 $ tip.label  : chr [1:8] "Species.8" "Species.4" "Species.2" "Species.3" ...
 $ Nnode      : int 7
 - attr(*, "class")= chr "phylo"
 - attr(*, "order")= chr "cladewise"</code></pre>
</div>
</div>
</section>
<section id="preparing-and-manipulating-trees" class="level2">
<h2 class="anchored" data-anchor-id="preparing-and-manipulating-trees">4. Preparing and manipulating trees</h2>
<section id="branch-length-vs.-dated-trees" class="level3">
<h3 class="anchored" data-anchor-id="branch-length-vs.-dated-trees">4.1 Branch length vs.&nbsp;dated trees</h3>
<ul>
<li>By default, when you reconstruct a phylogenetic tree from DNA sequence data it will not be ultrametric
<ul>
<li>Instead, branch lengths are proportional to the number of DNA substitutions</li>
</ul></li>
<li>The tips do not all line up at the present day
<ul>
<li>Reason: more DNA substitutions are inferred along some branches than others</li>
</ul></li>
<li>However, many types of phylogenetic analysis require an ultrametric tree, where branch lengths reflect relative times rather than amounts of change</li>
<li>At a minimum, an ultrametric tree gives relative dates and ages
<ul>
<li>With a calibration point such as a fossil date, it can even be expressed in millions of years of geological time</li>
</ul></li>
<li>There are various methods for converting a non-ultrametric tree into an ultrametric one, based on assumptions about how evolutionary rates change on the tree</li>
<li>First, we can generate a random tree that is not ultrametric using the alternative function <em>rtree()</em></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>random.tree <span class="ot">&lt;-</span> <span class="fu">rtree</span>(<span class="at">n=</span><span class="dv">8</span>, <span class="at">tip.label=</span>my.tip.labels)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(random.tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="PhylogeneticTrees_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.ultrametric</span>(random.tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.ultrametric</span>(random.coalescent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The <em>chronos</em> function
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>We can fit unequal branches into an ultrametric tree using the <em>chronos</em> function
<ul>
<li>This uses penalised likelihood to minimise evolutionary rate variation across the tree</li>
</ul></li>
<li>The details of this are <strong>not important</strong></li>
</ul>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>ult.tree <span class="ot">&lt;-</span> <span class="fu">chronos</span>(random.tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Setting initial dates...
Fitting in progress... get a first set of estimates
         (Penalised) log-lik = -10.71523 
Optimising rates... dates... -10.71523 
Optimising rates... dates... -10.71521 

log-Lik = -10.6558 
PHIIC = 61.34 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.ultrametric</span>(ult.tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ult.tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="PhylogeneticTrees_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>These are more sophisticated methods for dating trees based on DNA seqquence data
<ul>
<li>You can incluse fossil or other calibrations to set the scale to millions of years</li>
</ul></li>
<li>This function provides a simple way to re-estimate branch lengths on a tree with non-ultrametric branches</li>
<li>With an ultrametric tree, you can extract the (relative) ages of each node using an APE function:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">branching.times</span>(ult.tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        9        10        11        12        13        14        15 
1.0000000 0.5427151 0.2909993 0.2653661 0.5984753 0.2775419 0.2045734 </code></pre>
</div>
</div>
</section>
<section id="polytomies-vs.-bifurcating-trees" class="level3">
<h3 class="anchored" data-anchor-id="polytomies-vs.-bifurcating-trees">4.2 Polytomies vs.&nbsp;bifurcating trees</h3>
<ul>
<li>We tend to think of the true pattern of evolutionary branching as dichotomous, i.e.&nbsp;fully bifurcating trees</li>
<li>In reality, there may be insufficient time and change on a particular branch to resolve it and we can end up with a polytomy
<ul>
<li><strong>Hard polotomy</strong>: a node with 3 or more branches descending directly from it</li>
<li><strong>Soft polytomy</strong>: may be coded as a bifurcating topology, but some branchs lengths are zero / so close to zero that it looks like a polotomy when plotted</li>
</ul></li>
<li>A lot of important tree functions assume a fully resolved tree</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.binary</span>(star.tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.binary</span>(balanced.tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<ul>
<li>The star tree has a single multichotomy at the root, so is not bindary (bifurcating)</li>
<li>There is a function for resolving such trees with the branching order decided randomly:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>new.star.tree <span class="ot">&lt;-</span> <span class="fu">multi2di</span>(star.tree)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is.binary</span>(new.star.tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
<section id="cosmetics-for-plotting-trees" class="level3">
<h3 class="anchored" data-anchor-id="cosmetics-for-plotting-trees">4.3 Cosmetics for plotting trees</h3>
<ul>
<li>A rooted tree can be thought of like a hanging mobile
<ul>
<li>We can swing around any of the nodes and the tree stays the same</li>
</ul></li>
<li>For plotting, some ways of arranging the mobile might look better than others, and we examined the rotate function and its limitations earlier</li>
<li>There are some useful non-R applications for tinkering with trees to make them look nice, such as FigTree, but APE also has some functions to tidy up trees</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(par)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>ladderized.tree<span class="ot">&lt;-</span><span class="fu">ladderize</span>(random.coalescent,<span class="at">right=</span><span class="cn">TRUE</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ladderized.tree)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>ladderized.tree<span class="ot">&lt;-</span><span class="fu">ladderize</span>(random.coalescent,<span class="at">right=</span><span class="cn">FALSE</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ladderized.tree)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="fu">axisPhylo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="PhylogeneticTrees_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Explaining the first line of the above code
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>par()</strong>: this function is used to modify the graphical parameters of plots in R</li>
<li><strong>mfrow</strong>: this parameter specifies the layout on the plotting window in terms of rows and columns
<ul>
<li>It tells R how to arrange multiple plots within the same plotting space</li>
</ul></li>
<li><strong>c(1,2)</strong>: rows, columns</li>
</ul>
</div>
</div>
<ul>
<li>For non-ultrametric trees, add a scale bar using <strong>add.scale.bar()</strong></li>
<li>The <strong>plot.phylo()</strong> function also plots other styles of trees:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="at">cex=</span><span class="dv">1</span>, <span class="at">mar=</span><span class="fu">c</span>(<span class="fl">0.2</span>,<span class="fl">0.2</span>,<span class="fl">0.2</span>,<span class="fl">0.2</span>))</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(random.coalescent,<span class="at">type=</span><span class="st">"unrooted"</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(random.coalescent,<span class="at">type=</span><span class="st">"fan"</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(random.coalescent,<span class="at">type=</span><span class="st">"cladogram"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="PhylogeneticTrees_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Explaining the first line of the above code
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>mfrow=c(1,3)</strong>: specifies the layout in a 1x3 grid</li>
<li><strong>cex=1</strong>: this is the character expansion
<ul>
<li>This sets the text to the default size (1)</li>
</ul></li>
<li><strong>mar=c(0.2,0.2,0.2,0.2)</strong>: this species the margins around each plot
<ul>
<li>Form: c(bottom, left, top, right)</li>
<li>This has set vert narrow margins around the plots</li>
<li>It is useful for minimising white space around the plots, allowing them to occupy more of the plotting area</li>
</ul></li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
When would we use each tree?
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Unrooted</strong> can be useful for population samples</li>
<li><strong>Circular</strong> can help to show major clade relationships on very large trees</li>
<li><strong>Phylograms/cladograms</strong> are the most informative if there are no branch lengths included</li>
</ul>
</div>
</div>
<p>You can change tip size/labels:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(random.coalescent, <span class="at">type=</span><span class="st">"fan"</span>, <span class="at">show.tip.label=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="PhylogeneticTrees_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(random.coalescent, <span class="at">type=</span><span class="st">"fan"</span>, <span class="at">cex=</span><span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="PhylogeneticTrees_files/figure-html/unnamed-chunk-32-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Using <strong>help(plot.phylo)</strong> shows a full list of options.</p>
</section>
</section>
<section id="reading-in-real-trees-and-matching-data" class="level2">
<h2 class="anchored" data-anchor-id="reading-in-real-trees-and-matching-data">5. Reading in real trees and matching data</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
How can we read real trees into R?
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Trees that are produced by standard phylogenetics software tend to be saved as files in Newick format</li>
<li>Newick uses curved brackets to record the topology of a tree</li>
<li>For example, an imbalanced tree with four taxa, A, B, C and D is given by:
<ul>
<li>(((A,B),C),D)</li>
</ul></li>
<li>If there are branch lengths, these are specified using:
<ol type="1">
<li>Colons after each taxon name (for <strong>terminal</strong> branches)</li>
<li>Colons after each closed bracket (for <strong>internal</strong> branches)</li>
</ol>
<ul>
<li>E.g. (((A:1.5,B:1.5):1,C:2.5):2,D:4.5)</li>
</ul></li>
<li>It is possible to read these trees directly into R:</li>
</ul>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>tr <span class="ot">&lt;-</span> <span class="fu">read.tree</span>(<span class="at">text =</span> <span class="st">"(((A:1.5,B:1.5):1,C:2.5):2,D:4.5);"</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="PhylogeneticTrees_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In reality, you will be working with files containing the tree</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The coffee wilt pathogen
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>One example tree is included in the downloads (Ffuji.tre), which is a tree of six isolates of the coffee wilt pathogen, <em>Fusarium xylarioides</em>, and some related species in the <em>Fusarium fujikori</em> species complex of pathogenic fungi</li>
<li><em>F. udum</em> is a wilt pathogen of pigeon pea
<ul>
<li>The others are not wilt-causing pathogens</li>
</ul></li>
</ul>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>fusarium.tr <span class="ot">&lt;-</span> <span class="fu">read.tree</span>(<span class="at">file =</span> <span class="st">"Ffuji.tre"</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fusarium.tr)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="fu">axisPhylo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="PhylogeneticTrees_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>This tree was reconstructed from thousands of loci and calibrated in millions of years using a typical rate of nuclear gene evolution for fungi
<ul>
<li>The root node is dated to ~17mya</li>
</ul></li>
</ul>
<p>There are 2 things to note:</p>
<ol type="1">
<li>Some tree files contain multiple trees, in which case the object produced by <strong>read.tree()</strong> will be a list of multiple trees
<ul>
<li>Each can be accessed via tr[[1]], tr[[2]] and so on</li>
<li>Double square brackets are used to access items in a list, in the same way we use single square brackets to index entries in a matrix</li>
</ul></li>
<li>Some trees are saved in a similar but alternative format called Nexus, which can be uploaded using the <strong>read.nexus()</strong> function in otherwise the same way
<ul>
<li>All tree files can be opened in a text editor to look at what is in them</li>
<li>A newick file will just have trees in the curved bracket notation described above, whereas a Nexus file has <em>Begin Nexus;</em> at the start and can contain lots of additional information</li>
</ul></li>
</ol>
<section id="matching-a-tree-with-data" class="level3">
<h3 class="anchored" data-anchor-id="matching-a-tree-with-data">5.1 Matching a tree with data</h3>
<ul>
<li>The download also includes a .csv file with some phenotypic data
<ul>
<li><strong>Data</strong>: whether each taxon causes wilt or not</li>
</ul></li>
<li>Of course, in real studies you might have a much larger dataset than this, with multiple columns, and it is useful to be able to match up different datasets</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>fusarium.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"Ffuji.data.csv"</span>, <span class="at">header=</span><span class="cn">TRUE</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fusarium.data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Taxon Wilt
1     F_fujikori    0
2   F_mangiferae    0
3 F_proliferatum    0
4         F_udum    1
5 F_verticillium    0
6        Fxyl254    1</code></pre>
</div>
</div>
<ul>
<li>The names are not written in the same way as in the tree
<ul>
<li>This is fixable!</li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
How can we convert the table names into tree names?
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>First, there are additional underscore characters
<ul>
<li>We can make a new vector of names that gets rid of those using <strong>gsub()</strong>, which is like R’s version of find and replace</li>
</ul></li>
<li>Next, we need to truncate the first five names to be just 4 characters long, and enter the updated names into the table
<ul>
<li>This uses the <strong>substring()</strong> function</li>
</ul></li>
<li>We also need to match up the data
<ul>
<li>The taxa are not in the same order as in the tree</li>
</ul></li>
</ul>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>new.names <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"_"</span>, <span class="st">""</span>, fusarium.data<span class="sc">$</span>Taxon)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>new.names[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="fu">substring</span>(new.names[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>],<span class="dv">1</span>,<span class="dv">4</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>fusarium.data<span class="sc">$</span>Taxon <span class="ot">&lt;-</span> new.names</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pmatch</span>(fusarium.tr<span class="sc">$</span>tip.label, fusarium.data<span class="sc">$</span>Taxon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  2  3  1  5  4  8 11 10  9  7  6</code></pre>
</div>
</div>
<p><strong>pmatch</strong>: the output tells us what position each element in the first vector occupies in the second vector - They are currently aligned as code is already fixed during the exercise</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>fusarium.data <span class="ot">&lt;-</span> fusarium.data[<span class="fu">pmatch</span>(fusarium.tr<span class="sc">$</span>tip.label,fusarium.data<span class="sc">$</span>Taxon),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is overwriting, which is bad practice</p>
</div>
</div>
</section>
</section>
<section id="analysing-the-properties-of-trees" class="level2">
<h2 class="anchored" data-anchor-id="analysing-the-properties-of-trees">6. Analysing the properties of trees</h2>
<section id="total-branch-length" class="level3">
<h3 class="anchored" data-anchor-id="total-branch-length">6.1 Total branch length</h3>
<ul>
<li>Total branch length might be of interest for describing phylogenetic diversity</li>
<li>For example, some studies calculate how much evolutionary history is represented by extant species in a clade, and how that would change if some of the species went extinct
<ul>
<li>How many millions of years of unique evolutionary history would we lose?</li>
</ul></li>
<li>To answer this question needs a tree with branch lengths calibrated in millions of years</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(fusarium.tr<span class="sc">$</span>edge.length)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 76.40981</code></pre>
</div>
</div>
<p>The following code removes species and recalculates:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>fusarium.tr.trim <span class="ot">&lt;-</span> <span class="fu">drop.tip</span>(fusarium.tr, <span class="fu">c</span>(<span class="st">"Fver"</span>, <span class="st">"Fpro"</span>))</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fusarium.tr.trim)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">axisPhylo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="PhylogeneticTrees_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(fusarium.tr.trim<span class="sc">$</span>edge.length)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 56.81702</code></pre>
</div>
</div>
<ul>
<li>The following code removes a random selection of tips:
<ul>
<li>E.g. choosing 3 numbers at random from 1-11</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>fusarium.tr<span class="sc">$</span>tip.label[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>,<span class="dv">3</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Fpro"    "Fxyl254" "Fudu"   </code></pre>
</div>
</div>
<ul>
<li>To mark them for extinction, we could substitute that into the <strong>drop.tip()</strong> function above
<ul>
<li>That would allow you to look at at how much phylogenetic diversity you are left with when you lose 3 species</li>
</ul></li>
<li>To estimate the average loss, you could write a <strong>for()</strong> loop to repeat this operation
<ul>
<li>Then, work out what range of outcomes there are across random trials if you repeated it 100 or 1000 times</li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
How do we find the unique evolutionary history of a given tip?
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>The unique evolutionary history of a given tip is simply the terminal branch leading to it</li>
</ul>
<ol type="1">
<li>We find the terminal branch for tip i (we set this to 1 earlier)</li>
<li>Then, we find the length of that branch, using the same kind of notation we met in sections 2 and 3:</li>
</ol>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>terminal.branch <span class="ot">&lt;-</span> <span class="fu">which</span>(fusarium.tr<span class="sc">$</span>edge[,<span class="dv">2</span>]<span class="sc">==</span>i)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>fusarium.tr<span class="sc">$</span>edge.length[terminal.branch]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8.028423</code></pre>
</div>
</div>
<p>This tip evolved ~8mya</p>
</section>
<section id="how-imbalanced-is-the-tree" class="level3">
<h3 class="anchored" data-anchor-id="how-imbalanced-is-the-tree">6.2 How imbalanced is the tree?</h3>
<ul>
<li>Early studies looking at properties of phylogenetic trees were interested in balance and imbalance among clades</li>
<li>This is an intriguing property because imbalance doesn’t just mean that some sub-clades are more diverse than others, but there is some kind of progressive branching
<ul>
<li>The next branching event is likely to be on a descendant branch of the previous branching event, rather than on any other branch in the tree</li>
</ul></li>
<li>The studies compared the amount of balance in observed trees to the expected distribution of balance across a set of randomly generated trees
<ul>
<li>This was to show that real trees tend to be more imbalanced than expected by random branching</li>
</ul></li>
</ul>
<section id="the-balance-function" class="level5 callout:tip">
<h5 class="anchored" data-anchor-id="the-balance-function">The balance function</h5>
<ul>
<li>The function <strong>balance()</strong> counts the number of descendants of the 2 clades descended from each internal node</li>
</ul>
</section>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>my.balance.table <span class="ot">&lt;-</span> <span class="fu">balance</span>(random.coalescent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We could calculate an average measure of balance for the whole tree - The following code uses a <strong>for</strong> loop to sort each row so that the most diverse sister clade is shown in column 1:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(my.balance.table))) {</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (my.balance.table[i,<span class="dv">1</span>]<span class="sc">&lt;</span>my.balance.table[i,<span class="dv">2</span>]) {</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>        my.balance.table[i,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]<span class="ot">&lt;-</span> my.balance.table[i,<span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>]}</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The following code is an <strong><em>alternative way</em> to do the code above</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>my.balance.table <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">apply</span>(my.balance.table, <span class="dv">1</span>, <span class="cf">function</span>(row) <span class="fu">sort</span>(row, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The following code calculates the proportion of diversity in the more diverse sister clade at each node:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>my.balance.table[,<span class="dv">1</span>]<span class="sc">/</span>(my.balance.table[,<span class="dv">2</span>]<span class="sc">+</span>my.balance.table[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        9        10        11        12        13        14        15 
0.5000000 0.5000000 0.5000000 0.7500000 0.5000000 0.6666667 0.5000000 </code></pre>
</div>
</div>
<p>The following code expresses this as a mean across all the nodes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(my.balance.table[,<span class="dv">1</span>]<span class="sc">/</span>(my.balance.table[,<span class="dv">2</span>]<span class="sc">+</span>my.balance.table[,<span class="dv">1</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5595238</code></pre>
</div>
</div>
<ul>
<li>This imbalance metric varies from 0.5 to approaching 1.0
<ul>
<li>Higher value = more imbalance</li>
</ul></li>
<li>We can <strong>write a function</strong> to do all these steps on any tree
<ul>
<li>We can easily repeat it at multiple times for multiple trees:</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>imbalance.metric <span class="ot">&lt;-</span> <span class="cf">function</span> (tr) {</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>    <span class="do">##Calculate number tips in sister clades at each node</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>    x<span class="ot">&lt;-</span><span class="fu">balance</span>(tr)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>    <span class="do">##Sort the table so most diverse sister clade is in the first column</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    <span class="do">##using the for loop approach</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(x))) {</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (x[i,<span class="dv">1</span>]<span class="sc">&lt;</span>x[i,<span class="dv">2</span>]) {</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>        x[i,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]<span class="ot">&lt;-</span> x[i,<span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>]}</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>    <span class="do">##Return the mean of the proportions of diversity in the most diverse sister clade</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">mean</span>(x[,<span class="dv">1</span>]<span class="sc">/</span>(x[,<span class="dv">1</span>]<span class="sc">+</span>x[,<span class="dv">2</span>])))}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>This code repeats what we just did
<ul>
<li>Instead, it uses <em>tr</em> to denote a tree object that is required by our function</li>
<li>Then, it uses <em>x</em> inside the function to denote the balance table</li>
</ul></li>
<li>When we run the function on any tree object, it will give our final imbalance metric:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">imbalance.metric</span>(random.coalescent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5595238</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">imbalance.metric</span>(imbalanced.tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7545918</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">imbalance.metric</span>(fusarium.tr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6709416</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>If you are writing a function, it is always worth writing your code outside of the function first and inspecting the outputs to check it is working, before you add it inside a function for ease of repeated use on multiple objects</li>
<li>It is much easier to troubleshoot outside of a function than inside</li>
</ul>
</div>
</div>
</section>
<section id="mapping-a-binary-character" class="level3">
<h3 class="anchored" data-anchor-id="mapping-a-binary-character">6.3 Mapping a binary character</h3>
<ul>
<li>We often use phylogenetic trees to explore trait evolution, and the first step is mapping changes in a character trait onto the tree</li>
<li>There are various methods to do this, depending whether the character is continuous or discrete</li>
<li>Let’s try mapping the wilt-causing trait onto the <em>Fusarium</em> tree</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Mapping the wilt-causing trait
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>We can reconstruct the character along the tree using maximum likelihood</li>
<li>This approach estimates the evolutionary rate of the character and simultaneously estimates the likelihood that the ancestral state at each node was either 0 or 1
<ul>
<li>The default version assumes that the rate of changing from 0 to 1 is the same as changing from 1 to 0, per unit time along a branch</li>
</ul></li>
<li>It fits the ancestral state at each node and the value of evolutionary rate that yields the maximum likelihood for the model</li>
<li>The function is called <em>ace()</em>, for <em>a</em>ncestral <em>c</em>haracter <em>e</em>stimation, and we tell it that our character is to be treated as discrete</li>
</ul>
</div>
</div>
<p>The following code clears values stored at the nodes to allow the function to write new entries:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>fusarium.tr<span class="sc">$</span>node.label <span class="ot">&lt;-</span> <span class="cn">NULL</span>    </span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>recon <span class="ot">&lt;-</span> <span class="fu">ace</span>(fusarium.data<span class="sc">$</span>Wilt, fusarium.tr, <span class="at">type =</span> <span class="st">"discrete"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you look at the recon object that is the result of applying the function, you can see it provides the likelihood, a little table showing:</p>
<ol type="1">
<li>The indices for each rate (in our case there is only one rate, so this is a bit redundant, but it would be informative for some more complex models)</li>
<li>The estimate of the evolutionary rate and its standard error</li>
<li>The scaled likelihoods that the ancestral state at the root of the tree was 0 or 1</li>
</ol>
<p>You can see the likelihood of ancestral states for all nodes by extracting the correct part of the <em>ace()</em> output:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>recon</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ancestral Character Estimation

Call: ace(x = fusarium.data$Wilt, phy = fusarium.tr, type = "discrete")

    Log-likelihood: -2.995596 

Rate index matrix:
  0 1
0 . 1
1 1 .

Parameter estimates:
 rate index estimate std-err
          1   0.0244  0.0178

Scaled likelihoods at the root (type '...$lik.anc' to get them for all nodes):
       0        1 
0.700219 0.299781 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>recon<span class="sc">$</span>lik.anc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              0           1
12 7.002190e-01 0.299781029
13 9.762689e-01 0.023731142
14 9.945325e-01 0.005467496
15 6.299461e-01 0.370053852
16 1.418051e-01 0.858194875
17 3.630135e-04 0.999636986
18 6.235068e-07 0.999999376
19 1.076007e-05 0.999989240
20 4.909265e-06 0.999995091
21 4.188584e-06 0.999995811</code></pre>
</div>
</div>
<ul>
<li>Each row now signifies a node and the scaled likelihood of each state
<ul>
<li>So 0.5 and 0.5 would mean an equal chance of being in either state, the model really can’t distinguish</li>
<li>A value close to 1 would mean the model has a high likelihood for that node to be a particular ancestral state</li>
</ul></li>
</ul>
<p>We primarily want to see how the character changes on the whole tree</p>
<p>We can plot this out as follows:</p>
<ol type="1">
<li>Plot the tree</li>
<li>Set up a vector with the colours we want to use to represent each state (blue = no wilt, yellow = wilt)</li>
<li>Use these to plot out circles at the tips and little bars shaded according to the likelihood of each state for the internal nodes</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fusarium.tr, <span class="at">type =</span> <span class="st">"phylogram"</span>, <span class="at">label.offset=</span><span class="fl">0.5</span>)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"yellow"</span>)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tiplabels</span>(<span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> cols[fusarium.data<span class="sc">$</span>Wilt<span class="sc">+</span><span class="dv">1</span>], <span class="at">cex =</span> <span class="fl">1.5</span>)</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="fu">nodelabels</span>(<span class="at">thermo =</span> recon<span class="sc">$</span>lik.anc, <span class="at">piecol =</span> cols, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="fu">axisPhylo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="PhylogeneticTrees_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="downloading-a-tree-of-open-tree-of-life" class="level3">
<h3 class="anchored" data-anchor-id="downloading-a-tree-of-open-tree-of-life">7. Downloading a tree of Open Tree of Life</h3>
<ul>
<li>For the assignment, we’re going to ask you to obtain an existing published tree of your choice and perform some analyses on it, related to the ones we tried above
<ul>
<li>A very convenient place to look for a tree is the Open Tree of Life server: https://tree.opentreeoflife.org</li>
</ul></li>
</ul>
<ol type="1">
<li>Go to the <strong>Add/Browse Trees</strong> menu, and a list of studies appears, you can add terms to filter and narrow down</li>
<li>Click on a study that looks interesting and then again under “Tree name” to see the tree
<ul>
<li>It shows a phylogram and if you click on properties it tells you whether the tree includes branch lengths, which is necessary for the assignment</li>
</ul></li>
<li>To download a tree, close the tree viewing window then click on download a newick tree in the bottom right of the study window
<ul>
<li>This pops up in the format described above and you can download or copy and paste into a text editor and save as something like “Snakes.tre”</li>
</ul></li>
<li>Then you can load this into R using the commands above and proceed with the assignment</li>
</ol>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>